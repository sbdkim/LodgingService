<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="RoomMapper">
	<!-- 예약하기 -->
	<insert id="insertBooking">
		INSERT INTO booking(bseq, rseq, email, ckindate, ckoutdate, price, payment, status)
		VALUES(book_seq.NEXTVAL, #{resq}, #{email}, #{ckindate}, #{ckoutdate}, #{price}, #{payment}, #{status})
	</insert>
	
	<!-- accommodation List에서 하나를 누르면 그 accommodation에 관련된 모든 room출력 -->
	<select id="selectRoomByAcc" resultType="room">
		SELECT * from room WHERE aseq=#{aseq}
	</select>
	
	<!-- 숙박업체 등록  --> 
	
	
	
	
	
	<!-- 이름, 이메일로 예약내역 조회 -->
	<select id="listBookByNameEmail" resultType="booking">
		SELECT * FROM booking_view
		WHERE name=#{name} AND email=#{email}
	</select>
	
	<!-- 예약번호로 예약내역 조회 -->
	<select id="selectBookByBseq" resultType="booking">
		SELECT * FROM booking_view
		WHERE bseq=#{bseq}
	</select>
	
	<!-- 예약번호로 예약수정 -->
	<update id="updateBookByBseq">
		UPDATE booking SET rseq=#{rseq}, ckindate=#{ckindate}, ckoutdate=#{ckoutdate}
		WHERE bseq=#{bseq}
	</update>
	
	<!-- 예약번호로 예약취소 -->
	<delete id="deleteBookByBseq">
		DELETE booking WHERE bseq=#{bseq}
	</delete>
	
	
	
	
	
	<select id="listRoomWithPaging" resultType="room">
		<![CDATA[
		SELECT * FROM
		(SELECT row_number() OVER (ORDER BY name) rn, name, price, maxcap, ckintime, ckouttime, rooms, bathroom, bed, wifi, kitchen, pool, ac, tv, coffeemachine, fridge, bathtub, parking, heater, microwave, kettle, washer, bbq, hairdrier, amenity, towel, elevator, breakfast, smoking, gym, roomservice, image1, image2, image3, image4, image5
		FROM room WHERE aseq = #{aseq}
		WHERE rn <= #{criteria.pageNum} * #{criteria.rowsPerPage}
		AND rn > (#{criteria.pageNum}-1) * #{criteria.rowsPerPage}
		]]>
	</select>
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
</mapper>
