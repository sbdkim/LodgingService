<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="AccommodationMapper">
	<!-- 지역으로 숙소 검색 -->
	<select id="selectAccByAdd" resultType="accommodation">
		SELECT * FROM accommodation
		WHERE address like '%'||#{address}||'%'
	</select>
	
	<!-- 전체 숙소 조회 -->
	<select id="listAcc" resultType="accommodation">
		SELECT * FROM accommodation ORDER BY aseq
	</select>
	
	<!-- 숙소 갯수 조회 -->
	<select id="countAccList" parameterType="String" resultType="int">
		SELECT count(*) FROM accommodation WHERE address like '%'||#{address}||'%'
	</select>
	
	<select id="countHostAccList" parameterType="String" resultType="int">
		SELECT count(*) FROM accommodation WHERE email=#{email}
	</select>
	
	<!-- 페이지별 숙소 목록 조회 -->
	<select id="listAccWithPaging" resultType="accommodation">
		<![CDATA[
		SELECT * FROM
		(SELECT row_number() OVER (ORDER BY aname) rn, email, aname, category, address, tel, bestyn, aimage
		FROM accommodation WHERE address like '%'||#{address}||'%')
		WHERE rn <= #{criteria.pageNum} * #{criteria.rowsPerPage}
		AND rn > (#{criteria.pageNum}-1) * #{criteria.rowsPerPage}
		]]>
	</select>
	
	<!-- host 숙소 -->

	<select id="listHostAccWithPaging" resultType="accommodation">
		<![CDATA[
		SELECT * FROM
		(SELECT row_number() OVER (ORDER BY aname) rn, email, aname, category, address, tel, bestyn, aimage
		FROM accommodation WHERE email=#{email})
		WHERE rn <= #{criteria.pageNum} * #{criteria.rowsPerPage}
		AND rn > (#{criteria.pageNum}-1) * #{criteria.rowsPerPage}
		order by aname asc
		]]> 
	</select>
	
	<select id="selectAccByName" resultType="String">
		SELECT aname from accommodation
		WHERE aseq=#{aseq}
	</select>

   <select id="listHostAccommodation" resultType="accommodation">
      SELECT * FROM accommodation
      WHERE email=#{email}
   </select>

	<insert id="insertAccommodation" parameterType="accommodation">
		INSERT INTO accommodation(aseq, email, aname, category, address, tel, aimage)
		VALUES(accommodation_seq.NEXTVAL, #{email}, #{aname}, #{category}, #{address}, #{tel}, #{aimage})
	</insert>

</mapper>
