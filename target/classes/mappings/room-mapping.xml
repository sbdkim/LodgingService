<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="RoomMapper">
	<!-- 예약하기 -->
	<insert id="insertBooking">
		INSERT INTO booking(bseq, rseq, email, ckindate, ckoutdate, price, payment, status)
		VALUES(book_seq.NEXTVAL, #{resq}, #{email}, #{ckindate}, #{ckoutdate}, #{price}, #{payment}, #{status})
	</insert>
	

	<!-- 숙박업체 등록  --> 
	
	
	
	
	

	<!-- 예약번호로 예약내역 조회 -->
	<select id="selectBookByBseq" resultType="booking">
		SELECT * FROM booking_view
		WHERE bseq=#{bseq}
	</select>
	
	<!-- 예약번호로 예약수정 -->
	<update id="updateBookByBseq">
		UPDATE booking SET rseq=#{rseq}, ckindate=#{ckindate}, ckoutdate=#{ckoutdate}
		WHERE bseq=#{bseq}
	</update>
	
	<!-- 예약번호로 예약취소 -->
	<delete id="deleteBookByBseq">
		DELETE booking WHERE bseq=#{bseq}
	</delete>

	<!-- 숙소업체별 객실 조회 -->
	<select id="listRoomByAccommodation" resultType="room">
		SELECT * FROM list_room_view
		WHERE email=#{email}
	</select>

	
	
	
	<!-- accommodation List에서 하나를 누르면 그 accommodation에 관련된 모든 room출력 -->
	<select id="selectRoomByAcc" resultType="room">

	<![CDATA[
		SELECT * FROM room WHERE aseq=#{aseq} AND 
		rseq NOT IN (
		  SELECT rseq 
		  FROM booking 
		  WHERE ckindate <= #{ckindate}
		    AND ckoutdate >= #{ckoutdate})
		]]>

	
		
	</select>
	

	
	
	
	<select id="countRoomList" parameterType="int" resultType="int">
		SELECT count(*) FROM room WHERE aseq = #{aseq}
	</select>
	
	
	
	<select id="listRoomWithPaging" resultType="room">
		<![CDATA[
		SELECT * FROM
		(SELECT row_number() OVER (ORDER BY name) rn, name, price, maxcap, ckintime, ckouttime, rooms, bathroom, bed, wifi, kitchen, pool, ac, tv, coffeemachine, fridge, bathtub, parking, heater, microwave, kettle, washer, bbq, hairdrier, amenity, towel, elevator, breakfast, smoking, gym, roomservice, image1, image2, image3, image4, image5
		FROM room WHERE aseq = #{aseq}
		WHERE rn <= #{criteria.pageNum} * #{criteria.rowsPerPage}
		AND rn > (#{criteria.pageNum}-1) * #{criteria.rowsPerPage}
		]]>
	</select>
	
	<!-- rseq로 room 상세조회 -->
	<select id="selectRoomByRseq" resultType="room">
		SELECT * FROM room
		WHERE rseq=#{rseq}
	</select>

	
	<!-- rseq로 숙소조회 -->
	<select id="selectAccByRseq" resultType="room">
		SELECT * FROM list_room_view WHERE rseq=#{rseq}
	</select>

</mapper>
